# ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ì„¤ê³„ì„œ (Supabase/PostgreSQL)

## 1. ê°œìš” (Overview)
ë³¸ ë¬¸ì„œëŠ” ì›ë‹¨ ë§ˆìŠ¤í„° ê´€ë¦¬ ì‹œìŠ¤í…œì˜ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
UI/UX êµ¬í˜„ ê³¼ì •ì—ì„œ ë„ì¶œëœ ì¶”ê°€ ìš”êµ¬ì‚¬í•­(ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜, ê°€ê²© ì •ë³´, ìŠ¤íƒ€ì¼ ì½”ë“œ ì—°ê²° ë“±)ì„ ëª¨ë‘ ë°˜ì˜í•˜ì˜€ìœ¼ë©°, ë°ì´í„° ì´ë ¥ì„ ì¶”ì í•˜ê¸° ìœ„í•œ ê°ì‚¬(Audit) í•„ë“œë¥¼ ëª¨ë“  í…Œì´ë¸”ì— í¬í•¨í•©ë‹ˆë‹¤.

---

## 2. í…Œì´ë¸” ëª©ë¡ (Table List)

| í…Œì´ë¸”ëª… | ì„¤ëª… | ë¹„ê³  |
| :--- | :--- | :--- |
| **`fabric_master`** | ì›ë‹¨ ë§ˆìŠ¤í„° ê¸°ë³¸ ì •ë³´ | ë¸Œëœë“œ, ì‹œì¦Œ, í’ˆëª…, ë‹¨ê°€, ê·œê²© ë“± |
| **`fabric_mixing_ratio`** | ì›ë‹¨ í˜¼ìš©ë¥  ì •ë³´ (1:N) | ì†Œì¬ëª…, í˜¼ìš©ë¥ (%) |
| **`fabric_color`** | ìƒ‰ìƒ ë° íŒ¬í†¤ ì •ë³´ (1:N) | ìƒ‰ìƒëª…, íŒ¬í†¤ì½”ë“œ, ë¹„ê³  |
| **`fabric_style_link`** | ì›ë‹¨-ìŠ¤íƒ€ì¼ ì—°ê²° ì •ë³´ (1:N) | í—¤ë” ì„¹ì…˜ì˜ ìŠ¤íƒ€ì¼ ì½”ë“œ ì—°ê²° |

---

## 3. ê³µí†µ í•„ë“œ ì •ì˜ (Audit Fields)

ëª¨ë“  í…Œì´ë¸”ì— ê³µí†µì ìœ¼ë¡œ í¬í•¨ë˜ëŠ” í•„ë“œì…ë‹ˆë‹¤.

| í•„ë“œëª… | íƒ€ì… | ì„¤ëª… | ì œì•½ì¡°ê±´ |
| :--- | :--- | :--- | :--- |
| `created_at` | TIMESTAMPTZ | ìƒì„±ì¼ì‹œ | Default `now()` |
| `updated_at` | TIMESTAMPTZ | ìˆ˜ì •ì¼ì‹œ | Default `now()` |
| `created_by` | UUID | ìƒì„±ì ID | `auth.users.id` ì°¸ì¡° |
| `updated_by` | UUID | ìˆ˜ì •ì ID | `auth.users.id` ì°¸ì¡° |

---

## 4. ìƒì„¸ ìŠ¤í‚¤ë§ˆ ë° SQL (Detailed Schema & SQL)

### 4.1. `fabric_master` (ì›ë‹¨ ë§ˆìŠ¤í„°)

ì›ë‹¨ì˜ ê°€ì¥ ê¸°ë³¸ì ì¸ ì •ë³´ë¥¼ ë‹´ëŠ” ë©”ì¸ í…Œì´ë¸”ì…ë‹ˆë‹¤.

| í•„ë“œëª… | íƒ€ì… | ì„¤ëª… | ì œì•½ì¡°ê±´ |
| :--- | :--- | :--- | :--- |
| `id` | UUID | Primary Key | `default gen_random_uuid()` |
| `brand` | TEXT | ë¸Œëœë“œ (SPAO, ROEM ë“±) | Not Null |
| `season_year` | TEXT | ì‹œì¦Œ ì—°ë„ (2025) | Not Null |
| `season_month` | TEXT | ì‹œì¦Œ ì›” (1~12) | Not Null |
| `season_term` | TEXT | ì‹œì¦Œ ì°¨ìˆ˜ (1, 2, 3, 4) | Not Null |
| `art_no` | TEXT | í’ˆëª… | Unique, Not Null |
| `vendor_name` | TEXT | ê±°ë˜ì²˜ëª… |  |
| `category_major` | TEXT | ëŒ€ë¶„ë¥˜ (WOVEN, KNIT, OTHERS) |  |
| `category_middle` | TEXT | ì¤‘ë¶„ë¥˜ (PLAIN, TWILL ë“±) |  |
| `width` | TEXT | ê·œê²© í­ (58/60") |  |
| `weight` | TEXT | ê·œê²© ì¤‘ëŸ‰ (250 g/y) |  |
| `price` | DECIMAL | ë‹¨ê°€ |  |
| `currency` | TEXT | í™”í ë‹¨ìœ„ (USD, KRW, CNY) | Default 'USD' |
| *(Audit Fields)* | - | created_at, updated_at, by... |  |

#### ğŸ› ï¸ SQL Query
```sql
CREATE TABLE fabric_master (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  brand TEXT NOT NULL,
  season_year TEXT NOT NULL,
  season_month TEXT NOT NULL,
  season_term TEXT NOT NULL,
  art_no TEXT NOT NULL UNIQUE,
  vendor_name TEXT,
  category_major TEXT,
  category_middle TEXT,
  width TEXT,
  weight TEXT,
  price DECIMAL(10, 2),
  currency TEXT DEFAULT 'USD',
  
  -- Audit Fields
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now(),
  created_by UUID REFERENCES auth.users(id),
  updated_by UUID REFERENCES auth.users(id)
);

-- ë¹ ë¥¸ ê²€ìƒ‰ì„ ìœ„í•œ ì¸ë±ìŠ¤
CREATE INDEX idx_fabric_master_brand ON fabric_master(brand);
CREATE INDEX idx_fabric_master_art_no ON fabric_master(art_no);
```

---

### 4.2. `fabric_mixing_ratio` (í˜¼ìš©ë¥  ì •ë³´)

í•˜ë‚˜ì˜ ì›ë‹¨ì´ ì—¬ëŸ¬ ì†Œì¬ë¡œ êµ¬ì„±ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë³„ë„ í…Œì´ë¸”ë¡œ ë¶„ë¦¬í•©ë‹ˆë‹¤.

| í•„ë“œëª… | íƒ€ì… | ì„¤ëª… | ì œì•½ì¡°ê±´ |
| :--- | :--- | :--- | :--- |
| `id` | UUID | Primary Key | `default gen_random_uuid()` |
| `fabric_id` | UUID | Foreign Key | `fabric_master.id` (Cascade) |
| `fiber_type` | TEXT | ì†Œì¬ëª… (Polyester, Cotton ë“±) | Not Null |
| `percentage` | INT | ë¹„ìœ¨ (%) | Not Null |
| *(Audit Fields)* | - | created_at, updated_at, by... |  |

#### ğŸ› ï¸ SQL Query
```sql
CREATE TABLE fabric_mixing_ratio (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  fabric_id UUID NOT NULL REFERENCES fabric_master(id) ON DELETE CASCADE,
  fiber_type TEXT NOT NULL,
  percentage INT NOT NULL,

  -- Audit Fields
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now(),
  created_by UUID REFERENCES auth.users(id),
  updated_by UUID REFERENCES auth.users(id)
);

-- íŠ¹ì • ì›ë‹¨ì˜ í˜¼ìš©ë¥  ì¡°íšŒë¥¼ ìœ„í•œ ì¸ë±ìŠ¤
CREATE INDEX idx_mixing_ratio_fabric_id ON fabric_mixing_ratio(fabric_id);
```

---

### 4.3. `fabric_color` (ìƒ‰ìƒ ì •ë³´)

ì›ë‹¨ì˜ ìƒ‰ìƒë³„ ë³€í˜• ì •ë³´ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.

| í•„ë“œëª… | íƒ€ì… | ì„¤ëª… | ì œì•½ì¡°ê±´ |
| :--- | :--- | :--- | :--- |
| `id` | UUID | Primary Key | `default gen_random_uuid()` |
| `fabric_id` | UUID | Foreign Key | `fabric_master.id` (Cascade) |
| `color_name` | TEXT | ìƒ‰ìƒëª… (L/Beige) | Not Null |
| `pantone_code` | TEXT | íŒ¬í†¤ ì½”ë“œ (13-0647 TCX) |  |
| `style_code` | TEXT | ê°œë³„ ìƒ‰ìƒ ì—°ê²° ìŠ¤íƒ€ì¼ ì½”ë“œ |  |
| `memo` | TEXT | ë¹„ê³  |  |
| *(Audit Fields)* | - | created_at, updated_at, by... |  |

#### ğŸ› ï¸ SQL Query
```sql
CREATE TABLE fabric_color (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  fabric_id UUID NOT NULL REFERENCES fabric_master(id) ON DELETE CASCADE,
  color_name TEXT NOT NULL,
  pantone_code TEXT,
  style_code TEXT,
  memo TEXT,

  -- Audit Fields
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now(),
  created_by UUID REFERENCES auth.users(id),
  updated_by UUID REFERENCES auth.users(id)
);

CREATE INDEX idx_fabric_color_fabric_id ON fabric_color(fabric_id);
```

---

### 4.4. `fabric_style_link` (ê³µí†µ ìŠ¤íƒ€ì¼ ì½”ë“œ ì—°ê²°)

í—¤ë” ì„¹ì…˜ì—ì„œ "ìŠ¤íƒ€ì¼ ì½”ë“œ ì—°ê²°" ë²„íŠ¼ì„ í†µí•´ ë“±ë¡í•˜ëŠ”, ì›ë‹¨ ì „ì²´ì— ë§¤í•‘ë˜ëŠ” ìŠ¤íƒ€ì¼ ì½”ë“œë“¤ì…ë‹ˆë‹¤.

| í•„ë“œëª… | íƒ€ì… | ì„¤ëª… | ì œì•½ì¡°ê±´ |
| :--- | :--- | :--- | :--- |
| `id` | UUID | Primary Key | `default gen_random_uuid()` |
| `fabric_id` | UUID | Foreign Key | `fabric_master.id` (Cascade) |
| `style_code` | TEXT | ìŠ¤íƒ€ì¼ ì½”ë“œ | Not Null |
| *(Audit Fields)* | - | created_at, updated_at, by... |  |

#### ğŸ› ï¸ SQL Query
```sql
CREATE TABLE fabric_style_link (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  fabric_id UUID NOT NULL REFERENCES fabric_master(id) ON DELETE CASCADE,
  style_code TEXT NOT NULL,

  -- Audit Fields
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now(),
  created_by UUID REFERENCES auth.users(id),
  updated_by UUID REFERENCES auth.users(id)
);

CREATE INDEX idx_style_link_fabric_id ON fabric_style_link(fabric_id);
CREATE INDEX idx_style_link_code ON fabric_style_link(style_code);
```

---

## 5. ìë™í™” íŠ¸ë¦¬ê±° (Trigger for updated_at)

`updated_at` í•„ë“œê°€ ë°ì´í„° ìˆ˜ì • ì‹œ ìë™ìœ¼ë¡œ ê°±ì‹ ë˜ë„ë¡ íŠ¸ë¦¬ê±°ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

```sql
-- 1. ê°±ì‹  í•¨ìˆ˜ ìƒì„±
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = now();
    RETURN NEW;
END;
$$ language 'plpgsql';

-- 2. ê° í…Œì´ë¸”ì— íŠ¸ë¦¬ê±° ì ìš©
CREATE TRIGGER update_fabric_master_updated_at
    BEFORE UPDATE ON fabric_master
    FOR EACH ROW EXECUTE PROCEDURE update_updated_at_column();

CREATE TRIGGER update_fabric_mixing_ratio_updated_at
    BEFORE UPDATE ON fabric_mixing_ratio
    FOR EACH ROW EXECUTE PROCEDURE update_updated_at_column();

CREATE TRIGGER update_fabric_color_updated_at
    BEFORE UPDATE ON fabric_color
    FOR EACH ROW EXECUTE PROCEDURE update_updated_at_column();

CREATE TRIGGER update_fabric_style_link_updated_at
    BEFORE UPDATE ON fabric_style_link
    FOR EACH ROW EXECUTE PROCEDURE update_updated_at_column();
```